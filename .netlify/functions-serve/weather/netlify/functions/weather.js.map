{
  "version": 3,
  "sources": ["../../../../Documents/Apps/weer/netlify/functions/weather.js"],
  "sourceRoot": "C:/Users/Edwin/AppData/Local/Temp/tmp-2388-3dP9VPp7yppD",
  "sourcesContent": ["export const handler = async (event) => {\n  if (event.httpMethod !== 'GET') {\n    return { statusCode: 405, body: 'Method Not Allowed' };\n  }\n\n  // Security: Check for custom header to prevent basic script abuse\n  const appSource = event.headers['x-app-source'] || event.headers['X-App-Source'];\n  if (appSource !== 'EdwinWeerApp') {\n    return {\n       statusCode: 403,\n       headers: { 'Content-Type': 'application/json' },\n       body: JSON.stringify({ error: 'Unauthorized source' })\n    };\n  }\n\n  try {\n    const qs = event.queryStringParameters || {};\n    const { lat, lon, ...otherParams } = qs;\n\n    if (!lat || !lon) {\n      return {\n        statusCode: 400,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ error: 'Missing lat/lon parameters' })\n      };\n    }\n\n    const params = new URLSearchParams({ latitude: String(lat), longitude: String(lon), ...otherParams });\n    const url = `https://api.open-meteo.com/v1/forecast?${params.toString()}`;\n\n    const clientIp = event.headers?.['x-nf-client-connection-ip'] || event.headers?.['client-ip'];\n    console.log(`[Proxy] Request from ${clientIp || 'unknown'} for ${lat},${lon}`);\n\n    const response = await fetch(url);\n    if (!response.ok) {\n      const text = await response.text().catch(() => '');\n      return {\n        statusCode: response.status,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ error: `Upstream Error: ${response.statusText}`, details: text })\n      };\n    }\n\n    const raw = await response.text();\n    const trimmed = raw.trim();\n    if (!trimmed) {\n      return {\n        statusCode: 502,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ error: 'Upstream returned empty response' })\n      };\n    }\n\n    let data;\n    try {\n      data = JSON.parse(trimmed);\n    } catch {\n      return {\n        statusCode: 502,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          error: 'Upstream returned invalid JSON',\n          details: trimmed.slice(0, 500)\n        })\n      };\n    }\n    return {\n      statusCode: 200,\n      headers: {\n        'Content-Type': 'application/json',\n        'Cache-Control': 'public, max-age=300'\n      },\n      body: JSON.stringify(data)\n    };\n  } catch (error) {\n    console.error('Proxy Error:', error);\n    return {\n      statusCode: 500,\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ error: 'Internal Server Error' })\n    };\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAO,IAAM,UAAU,OAAO,UAAU;AACtC,MAAI,MAAM,eAAe,OAAO;AAC9B,WAAO,EAAE,YAAY,KAAK,MAAM,qBAAqB;AAAA,EACvD;AAGA,QAAM,YAAY,MAAM,QAAQ,cAAc,KAAK,MAAM,QAAQ,cAAc;AAC/E,MAAI,cAAc,gBAAgB;AAChC,WAAO;AAAA,MACJ,YAAY;AAAA,MACZ,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAC9C,MAAM,KAAK,UAAU,EAAE,OAAO,sBAAsB,CAAC;AAAA,IACxD;AAAA,EACF;AAEA,MAAI;AACF,UAAM,KAAK,MAAM,yBAAyB,CAAC;AAC3C,UAAM,EAAE,KAAK,KAAK,GAAG,YAAY,IAAI;AAErC,QAAI,CAAC,OAAO,CAAC,KAAK;AAChB,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAC9C,MAAM,KAAK,UAAU,EAAE,OAAO,6BAA6B,CAAC;AAAA,MAC9D;AAAA,IACF;AAEA,UAAM,SAAS,IAAI,gBAAgB,EAAE,UAAU,OAAO,GAAG,GAAG,WAAW,OAAO,GAAG,GAAG,GAAG,YAAY,CAAC;AACpG,UAAM,MAAM,0CAA0C,OAAO,SAAS,CAAC;AAEvE,UAAM,WAAW,MAAM,UAAU,2BAA2B,KAAK,MAAM,UAAU,WAAW;AAC5F,YAAQ,IAAI,wBAAwB,YAAY,SAAS,QAAQ,GAAG,IAAI,GAAG,EAAE;AAE7E,UAAM,WAAW,MAAM,MAAM,GAAG;AAChC,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,OAAO,MAAM,SAAS,KAAK,EAAE,MAAM,MAAM,EAAE;AACjD,aAAO;AAAA,QACL,YAAY,SAAS;AAAA,QACrB,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAC9C,MAAM,KAAK,UAAU,EAAE,OAAO,mBAAmB,SAAS,UAAU,IAAI,SAAS,KAAK,CAAC;AAAA,MACzF;AAAA,IACF;AAEA,UAAM,MAAM,MAAM,SAAS,KAAK;AAChC,UAAM,UAAU,IAAI,KAAK;AACzB,QAAI,CAAC,SAAS;AACZ,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAC9C,MAAM,KAAK,UAAU,EAAE,OAAO,mCAAmC,CAAC;AAAA,MACpE;AAAA,IACF;AAEA,QAAI;AACJ,QAAI;AACF,aAAO,KAAK,MAAM,OAAO;AAAA,IAC3B,QAAQ;AACN,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAC9C,MAAM,KAAK,UAAU;AAAA,UACnB,OAAO;AAAA,UACP,SAAS,QAAQ,MAAM,GAAG,GAAG;AAAA,QAC/B,CAAC;AAAA,MACH;AAAA,IACF;AACA,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,iBAAiB;AAAA,MACnB;AAAA,MACA,MAAM,KAAK,UAAU,IAAI;AAAA,IAC3B;AAAA,EACF,SAAS,OAAO;AACd,YAAQ,MAAM,gBAAgB,KAAK;AACnC,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAC9C,MAAM,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC;AAAA,IACzD;AAAA,EACF;AACF;",
  "names": []
}
